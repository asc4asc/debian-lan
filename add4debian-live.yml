---
- name: Erstelle Debian Live-CD mit toram
  hosts: all
  become: yes
  remote_user: ansible
  tasks:
    - name: Installiere notwendige Pakete
      apt:
        name: "{{ item }}"
        state: present
      with_items:
        - live-build
        - syslinux
        - isolinux
        - squashfs-tools
        - xorriso
        - grub-pc-bin
        - grub-efi-amd64-bin
        - grub-efi-ia32-bin
        - mtools
        - dosfstools

    - name: Erstelle Verzeichnis fÃ¼r Live-System
      file:
        path: /home/{{ ansible_user }}/live-debian
        state: directory

    - name: Initialisiere Live-Build-System
      command: >
        lb config noauto
        --clean
        --cache false
        --net-tarball false
        --ignore-system-defaults
        --security "false" 
        --updates "false"
        --distribution bookworm
        --mirror-bootstrap "http://deb.debian.org/debian/"
        --mirror-binary "http://deb.debian.org/debian/"
        --binary-images netboot
        --mode debian
        --backports true
        --linux-packages linux-image
        --archive-areas "main non-free-firmware contrib non-free"
        --cache-packages "false" 
        --archive-areas "main non-free-firmware contrib"
        --bootappend-live "boot=live username=ekf ${BOOT} nosplash"
        --bootappend-live-failsafe "boot=live ${BOOT} nosplash"
-     args:
        chdir: /home/{{ ansible_user }}/live-debian
        
    - name: Baue das Live-System
      command: lb build
      args:
        chdir: /home/{{ ansible_user }}/live-debian
