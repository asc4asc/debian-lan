---
- name: Create a new disabled user without a password
  hosts: all
  tasks:
    - name: Add a new user in a disabled state
      user:
        name: ekf
        comment: "Test User"
        shell: /bin/bash
        state: present
        password: "*"
      become: true  

    - name: Automatic login user ekf 
      ansible.builtin.lineinfile:
        path: /etc/gdm3/daemon.conf
        regexp: '^(#\s*)?\s*AutomaticLogin=.*'
        line: 'AutomaticLogin=ekf'
      become: true  

    - name: Grant sudo privileges to the user using sudoers.d
      copy:
        content: 'ekf ALL=(ALL) NOPASSWD:ALL'
        dest: /etc/sudoers.d/ekf
        mode: '0440'
        validate: 'visudo -cf %s'
      become: true  
